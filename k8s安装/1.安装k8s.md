# Ubuntu 18.04 x64 安装 Kubernetes 1.16.1

> 注意：版本一定要匹配，禁止自动更新系统

## 使用命令行工具kubeadm安装
> 该工具可以简化集群的安装过程

TODO: 添加安装步骤

## 切换软件源为中科大
```shell
sudo sed -i 's/archive.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list 
```

### （可选）禁止Ubuntu18.04每日检查更新和推荐更新
```
在updater中关闭所有检查更新和推荐更新选项
```

### 手动更新一次Ubuntu18.04系统
```shell
sudo apt update -y
sudo apt upgrade -y # 该命令(upgrade)在整个项目周期内只能执行这一次
sudo apt autoremove -y
reboot
```

### 关闭交换空间，并重新启动服务器
```shell
swapoff -a
# Important: And vim /etc/fstab to delete/comment the command of loading swap
vim /etc/fstab
# 注释swapfile那一行
reboot
```

### 安装Docker18.09.9，并设为开机自启动

> 根据Docker官网中Ubuntu系统的参考文档安装

#### 1.安装Docker-CE

```shell
sudo apt update -y
sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common
curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -
sudo add-apt-repository "deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"
sudo apt-get -y update
sudo apt-cache madison docker-ce
sudo apt install docker-ce=5:18.09.9~3-0~ubuntu-bionic
```

#### 更换Docker镜像源
```shell
sudo mkdir /etc/docker
sudo vim /etc/docker/daemon.json
# 添加如下内容
{
  	"registry-mirrors": ["https://2j754j2u.mirror.aliyuncs.com"]
}
sudo systemctl daemon-reload
sudo systemctl restart docker
```

### 安装k8s命令行安装工具，并设为开机自启动
```

deb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main
```

### 配置kubeadm配置文件

### 下载k8s的相关镜像

### 运行kubeadm init命令安装Master
```
kubeadm init --pod-network-cidr=10.244.0.0/16
```
注意：这里不要使用--config，目前使用--config从未成功

### 配置All-In-One的k8s环境

### 安装WebUI Dashboard
```shell
kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta4/aio/deploy/recommended.yaml
kubectl proxy
# 访问 http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
```

### 创建Admin用户，获取token
```shell
sudo kubectl create -f admin-user.yaml
sudo kubectl describe  secret admin-user --namespace=kube-system
```
### （TODO）安装Node，加入集群

### 安装网络插件

### 验证k8s集群是否安装完成



## 参考文档
